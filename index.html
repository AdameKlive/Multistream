<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multistream</title>

    <style>
        body {
            margin: 0;
            overflow-x: hidden; 
            background-color: black;
            display: flex;
            justify-content: center;
            font-family: Arial, sans-serif;
            color: white;
            height: 100vh; 
        }

        #globalContainer { 
            display: flex; 
            width: 100%; 
            height: 100%; 
            justify-content: space-between; 
            align-items: flex-start; 
        }

        #mainContent { 
            flex-grow: 1; 
            display: flex;
            flex-direction: column; 
            position: relative; 
            padding: 10px; 
            box-sizing: border-box; 
            width: 80%; 
        }

        #kickPlayer {
            width: 100%; 
            height: 100%; /* Ustawione przez JS */
            background-color: black;
        }

        #twitchPlayer {
            position: absolute;
            width: 427px;
            height: 240px;
            top: 10px;
            left: 10px;
            border: 2px solid white;
            z-index: 100; 
            transition: top 0.3s ease, left 0.3s ease, width 0.3s ease, height 0.3s ease; /* Płynne przejścia */
            /* Usunięto cursor: grab; */
        }
        /* Kontrolki usunięte z playera Twitcha */
        .controls { display: none !important; }

        /* === Sekcja czatu Twitcha - CHATSIDEBAR === */
        #chatSidebar { 
            display: flex;
            flex-direction: row; 
            width: 350px; 
            height: 100vh;
            border-left: 2px solid white;
            background-color: #1a1a1a;
            transition: width 0.3s ease; 
            overflow: hidden; 
            position: relative; 
        }

        #chatSidebar.hidden {
            width: 0; /* Całkowite ukrycie czatu */
        }

        #chatIframeContainer {
            flex-grow: 1; 
            display: flex;
            flex-direction: column;
            overflow: hidden; 
            transition: width 0.3s ease, opacity 0.3s ease; /* Animacja ukrywania */
        }

        #chatSidebar.hidden #chatIframeContainer {
            width: 0; 
            opacity: 0; 
        }

        #twitchChatIframe { 
            flex-grow: 1; 
            width: 100%;
            border: none;
        }

        /* Przyciski do ukrywania/pokazywania czatu - Zostają usunięte z HTML */
        .chat-toggle-buttons { display: none !important; }

        /* === NOWY GLOBALNY PRZYCISK OPCJI (ZĘBATKA) === */
        #optionsToggleBtn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.1); /* Półprzezroczyste tło */
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3); /* Półprzezroczysta ramka */
            border-radius: 50%; /* Okrągły kształt */
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2em;
            cursor: pointer;
            z-index: 200; /* Zawsze na wierzchu */
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }

        #optionsToggleBtn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }

        /* === MENU OPCJI === */
        #optionsMenu {
            position: fixed;
            bottom: 80px; /* Nad przyciskiem zębatki */
            left: 20px;
            background: rgba(0, 0, 0, 0.8); /* Ciemniejsze, półprzezroczyste tło menu */
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 8px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 8px; /* Odstępy między przyciskami */
            z-index: 199; /* Pod zębatką, ale nad resztą */
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px); /* Początkowo lekko w dół */
            transition: opacity 0.3s ease, transform 0.3s ease, visibility 0.3s ease;
        }

        #optionsMenu.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        #optionsMenu button {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            text-align: left; /* Wyrównanie tekstu do lewej */
            transition: background-color 0.2s ease;
            white-space: nowrap; /* Zapobiegaj łamaniu linii */
        }

        #optionsMenu button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        #optionsMenu .menu-group {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 8px;
            margin-bottom: 8px;
        }

        #optionsMenu .menu-group:last-child {
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 0;
        }
    </style>
</head>
<body>
    <div id="globalContainer"> 
        <div id="mainContent"> 
            <iframe id="kickPlayer" src="https://player.kick.com/imbotmundrol" frameborder="0" allowfullscreen="true"></iframe>

            <div id="twitchPlayer">
                <iframe src="https://player.twitch.tv/?channel=adamekl&parent=film.adameklive.pl" frameborder="0" allowfullscreen width="100%" height="100%"></iframe>
                </div>
        </div>

        <div id="chatSidebar"> 
            <div id="chatIframeContainer">
                <iframe id="twitchChatIframe" src="https://www.twitch.tv/embed/adamekl/chat?parent=film.adameklive.pl" frameborder="0" allowfullscreen sandbox="allow-storage-access-by-user-activation allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-modals"></iframe>
            </div>
            </div>
    </div>

    <button id="optionsToggleBtn" title="Opcje Strony">⚙️</button>

    <div id="optionsMenu">
        <div class="menu-group">
            <button id="shrinkTwitchPlayer">Pomniejsz Player TTV</button>
            <button id="expandTwitchPlayer">Powiększ Player TTV</button>
        </div>
        
        <div class="menu-group">
            <button id="positionTopLeft">Przenieś TTV: Lewy Górny</button>
            <button id="positionTopRight">Przenieś TTV: Prawy Górny</button>
            <button id="positionBottomLeft">Przenieś TTV: Lewy Dolny</button>
            <button id="positionBottomRight">Przenieś TTV: Prawy Dolny</button>
        </div>

        <div class="menu-group">
            <button id="toggleChatDock">Dokuj TTV nad czat</button>
        </div>

        <div class="menu-group">
            <button id="toggleChatVisibilityBtn">Ukryj/Pokaż Czat</button>
            <button id="toggleBrowserFullscreen">Pełny Ekran Strony</button>
        </div>
    </div>

    <script>
        const twitchPlayer = document.getElementById('twitchPlayer');
        const chatSidebar = document.getElementById('chatSidebar'); 
        const twitchChatIframe = document.getElementById('twitchChatIframe');
        const mainContent = document.getElementById('mainContent'); 
        const chatIframeContainer = document.getElementById('chatIframeContainer');

        // Nowe elementy
        const optionsToggleBtn = document.getElementById('optionsToggleBtn');
        const optionsMenu = document.getElementById('optionsMenu');

        // Przyciski z menu
        const shrinkTwitchPlayerBtn = document.getElementById('shrinkTwitchPlayer');
        const expandTwitchPlayerBtn = document.getElementById('expandTwitchPlayer');
        const positionTopLeftBtn = document.getElementById('positionTopLeft');
        const positionTopRightBtn = document.getElementById('positionTopRight');
        const positionBottomLeftBtn = document.getElementById('positionBottomLeft');
        const positionBottomRightBtn = document.getElementById('positionBottomRight');
        const toggleChatDockBtn = document.getElementById('toggleChatDock'); // Zmieniono id, aby uniknąć kolizji
        const toggleChatVisibilityBtn = document.getElementById('toggleChatVisibilityBtn'); // Nowe id dla przycisku w menu
        const toggleBrowserFullscreenBtn = document.getElementById('toggleBrowserFullscreen'); // Już było, ale teraz w menu

        const CHAT_VISIBLE_WIDTH = 350; 
        const CHAT_HIDDEN_WIDTH = 0; // Czat będzie całkowicie ukryty, więc jego szerokość to 0

        let minWidth = 213;
        let minHeight = 120;
        let maxWidth = 854;
        let maxHeight = 480;
        
        // Początkowe rozmiary playera Twitcha (możesz dostosować, jeśli chcesz by startował gdzie indziej)
        const initialPlayerWidth = 427;
        const initialPlayerHeight = 240;

        let isPlayerDockedToChat = false; 
        let isChatHidden = false; 

        // Funkcja do dynamicznego dostosowywania rozmiaru playera Kicka
        function adjustKickPlayerSize() {
            const mainContentRect = mainContent.getBoundingClientRect();
            const aspectRatio = 16 / 9; 

            let kickWidth = mainContentRect.width;
            let kickHeight = kickWidth / aspectRatio;

            const kickPlayer = document.getElementById('kickPlayer');
            kickPlayer.style.width = '100%';
            kickPlayer.style.height = `${kickHeight}px`;
        }

        window.addEventListener('load', adjustKickPlayerSize);
        window.addEventListener('resize', adjustKickPlayerSize);

        // --- OBSŁUGA MENU OPCJI ---
        let isMenuOpen = false;

        function toggleOptionsMenu() {
            isMenuOpen = !isMenuOpen;
            if (isMenuOpen) {
                optionsMenu.classList.add('show');
            } else {
                optionsMenu.classList.remove('show');
            }
        }

        optionsToggleBtn.addEventListener('click', (e) => {
            e.stopPropagation(); // Zapobiegaj zamykaniu menu po kliknięciu w zębatkę
            toggleOptionsMenu();
        });

        // Zamykanie menu po kliknięciu poza nim
        document.addEventListener('click', (e) => {
            if (isMenuOpen && !optionsMenu.contains(e.target) && e.target !== optionsToggleBtn) {
                toggleOptionsMenu();
            }
        });

        // --- ZMIANA ROZMIARU PLAYERA TTV ---
        function changeTwitchPlayerSize(delta) {
            let currentWidth = twitchPlayer.offsetWidth;
            let newWidth = currentWidth + delta;
            let newHeight = (newWidth * 9) / 16;

            newWidth = Math.min(Math.max(newWidth, minWidth), maxWidth);
            newHeight = Math.min(Math.max(newHeight, minHeight), maxHeight);

            twitchPlayer.style.width = `${newWidth}px`;
            twitchPlayer.style.height = `${newHeight}px`;

            if (isPlayerDockedToChat) {
                dockPlayerToChat(true); 
            }
        }

        shrinkTwitchPlayerBtn.addEventListener('click', () => changeTwitchPlayerSize(-42));
        expandTwitchPlayerBtn.addEventListener('click', () => changeTwitchPlayerSize(42));

        // --- PREDEFINIOWANE POZYCJE PLAYERA TTV ---
        function setTwitchPlayerPosition(position) {
            const kickPlayerRect = document.getElementById('kickPlayer').getBoundingClientRect();
            const twitchPlayerWidth = twitchPlayer.offsetWidth;
            const twitchPlayerHeight = twitchPlayer.offsetHeight;
            const padding = 10; // Odstęp od krawędzi Kick Playera

            let newLeft, newTop;

            switch (position) {
                case 'topLeft':
                    newLeft = kickPlayerRect.left + padding;
                    newTop = kickPlayerRect.top + padding;
                    break;
                case 'topRight':
                    newLeft = kickPlayerRect.right - twitchPlayerWidth - padding;
                    newTop = kickPlayerRect.top + padding;
                    break;
                case 'bottomLeft':
                    newLeft = kickPlayerRect.left + padding;
                    newTop = kickPlayerRect.bottom - twitchPlayerHeight - padding;
                    break;
                case 'bottomRight':
                    newLeft = kickPlayerRect.right - twitchPlayerWidth - padding;
                    newTop = kickPlayerRect.bottom - twitchPlayerHeight - padding;
                    break;
                default:
                    return;
            }

            // Przekształć pozycje globalne na względne do mainContent
            const mainContentRect = mainContent.getBoundingClientRect();
            twitchPlayer.style.left = `${newLeft - mainContentRect.left}px`;
            twitchPlayer.style.top = `${newTop - mainContentRect.top}px`;

            // Jeśli player był zadokowany, odokuj go
            if (isPlayerDockedToChat) {
                undockPlayerFromChat();
            }
            toggleOptionsMenu(); // Zamknij menu po wyborze pozycji
        }

        positionTopLeftBtn.addEventListener('click', () => setTwitchPlayerPosition('topLeft'));
        positionTopRightBtn.addEventListener('click', () => setTwitchPlayerPosition('topRight'));
        positionBottomLeftBtn.addEventListener('click', () => setTwitchPlayerPosition('bottomLeft'));
        positionBottomRightBtn.addEventListener('click', () => setTwitchPlayerPosition('bottomRight'));

        // Ustaw początkową pozycję Twitch playera (np. w lewym górnym rogu)
        // Możesz wybrać dowolną z 4 pozycji
        window.addEventListener('load', () => {
            // Poczekaj chwilę, żeby Kick Player miał szansę się wyrenderować
            setTimeout(() => {
                setTwitchPlayerPosition('topLeft'); 
            }, 100);
        });


        // --- Funkcjonalność DOCKOWANIA ---
        function dockPlayerToChat(forceRecalculate = false) {
            if (isPlayerDockedToChat && !forceRecalculate) return;

            if (isChatHidden) {
                toggleChatVisibility(false); // Pokaż czat jeśli ukryty
            }

            const chatSidebarRect = chatSidebar.getBoundingClientRect(); 
            const playerWidthOnDock = chatSidebarRect.width; // Szerokość całego sidebara
            
            twitchPlayer.style.width = `${playerWidthOnDock}px`;
            twitchPlayer.style.height = `${playerWidthOnDock * 9 / 16}px`;
            
            const playerHeightOnDock = twitchPlayer.offsetHeight; 

            twitchPlayer.style.position = 'absolute'; 
            // Pozycja względem mainContent: lewa krawędź chatSidebar - lewa krawędź mainContent
            const sidebarLeft = chatSidebarRect.left;
            const mainContentLeft = mainContent.getBoundingClientRect().left;
            twitchPlayer.style.left = `${sidebarLeft - mainContentLeft}px`; 
            twitchPlayer.style.top = `0px`; 

            twitchChatIframe.style.height = `calc(100% - ${playerHeightOnDock}px)`;
            twitchChatIframe.style.top = `${playerHeightOnDock}px`; 
            twitchChatIframe.style.position = 'relative'; 

            isPlayerDockedToChat = true;
            toggleChatDockBtn.textContent = 'Odeślij TTV z czatu';
            toggleOptionsMenu(); // Zamknij menu
        }

        function undockPlayerFromChat() {
            // Przywróć do domyślnej pozycji lewy górny róg Kicka
            setTwitchPlayerPosition('topLeft'); 

            twitchChatIframe.style.height = `100%`;
            twitchChatIframe.style.top = `0px`;
            twitchChatIframe.style.position = 'static'; 

            isPlayerDockedToChat = false;
            toggleChatDockBtn.textContent = 'Dokuj TTV nad czat';
        }

        toggleChatDockBtn.addEventListener('click', () => {
            if (isPlayerDockedToChat) {
                undockPlayerFromChat();
            } else {
                dockPlayerToChat();
            }
        });

        // --- Funkcjonalność UKRYWANIA/POKAZYWANIA CZATU ---
        function toggleChatVisibility(fromButton = true) {
            if (isChatHidden) { 
                chatSidebar.classList.remove('hidden');
                isChatHidden = false;
            } else { 
                chatSidebar.classList.add('hidden');
                isChatHidden = true;
                // Jeśli czat jest ukrywany, a player był zadokowany, odokuj go
                if (isPlayerDockedToChat) {
                    undockPlayerFromChat();
                }
            }
            adjustKickPlayerSize(); 
            toggleOptionsMenu(); // Zamknij menu
        }

        toggleChatVisibilityBtn.addEventListener('click', () => toggleChatVisibility(true));

        // --- Funkcjonalność PEŁNEGO EKRANU PRZEGLĄDARKI ---
        function toggleBrowserFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.error(`Błąd wejścia w tryb pełnoekranowy: ${err.message} (${err.name})`);
                });
            } else {
                document.exitFullscreen();
            }
            toggleOptionsMenu(); // Zamknij menu
        }

        toggleBrowserFullscreenBtn.addEventListener('click', toggleBrowserFullscreen);

        document.addEventListener('fullscreenchange', () => {
            if (document.fullscreenElement) {
                toggleBrowserFullscreenBtn.textContent = 'Wyjdź z Pełnego Ekranu'; 
            } else {
                toggleBrowserFullscreenBtn.textContent = 'Pełny Ekran Strony'; 
            }
            adjustKickPlayerSize(); 
        });

    </script>
</body>
</html>
